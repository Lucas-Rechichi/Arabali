{% load crispy_forms_tags %}
<style>
    .heading{
    display: flex;
    margin: auto;
}
    ul{
        list-style-type: none;
        padding-left: 40px;
}
    .custom-icon {
    position: relative;
    padding-left: 30px;
}
    .custom-icon i {
    position: absolute;
    left: 0;
}
    .topbar{
    width: 100%;
    height: 85px;
    background-color: rgb(186, 186, 186);
}
.logo-button{
    background-color: rgb(186, 186, 186);
    border: none;
    size: 60px;
    padding-left: 30px;
    padding-top: 15px;
}

.contents{
    padding: 30px;
    width: 70%;
    height: 70%;
    margin: auto;
    position: absolute;
    top: 50%;
    margin-top: 20px;
    text-align: center;
}
.post{
    padding: 30px;
    width: 85%;
    height: 85%;
    margin: auto;
    position: absolute;
    top: 50%;
    margin-top: 20px;
    text-align: left;
}
.add{
    width: 10%;
    margin: auto;
    position: absolute;
}
.profile{
    text-align: center;
    padding: 10px;
    margin: auto;
    position: absolute;
    width: 85%;
    height: 85%;
    margin-top: 25px;
}
.like {
    width: 10%;
    height: 10%;
    margin-left: 90%;
}
.pfp_image{
    width: 30px;
    height: 30px;
    border-radius:15px;
}
.pfp_button{
    height: 35px;
    width: 35px;
    background-color: #fff;
    border-radius: 17.5px;
    border-color: green;
    display: flex;
    justify-content: center;
    align-items: center;
}
.follow{
    width: 100px;
    left: 50%;
}
.profile-row-one{
    text-align: center;
}
.profile-pfp{
    height: 100px;
    width: 100px;
}
.sideopener{
    position: absolute;
    right: 10px;
    top: 20px;
}
.user-profile{
    position: absolute;
    height: 54px;
    width: 54px;
    right: 80px;
    top: 15px;
}
.user-image{
    position: absolute;
    right: 0px;
    bottom: 0px;
    height: 50px;
    width: 50px;
    border-radius: 25px;
}
.minipost{
    width: 300px;
    height: 100px;                          
}
.invis{
    border: none;
    background-color: #fff;

}
</style>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>For You | Arabali</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <div class="container">
                    <div class="row">
                        <div class="col-4">
                            <a href="/page/recommended|All/1" role="button" class="display-6 link-success link-offset-2 link-underline-opacity-0">Arabali</a>
                        </div>
                        <div class="col-4">
                            <form action="/search/q/1/1/1" method="post">
                                {% csrf_token %}
                                <div class="container">
                                    <div class="row">
                                        <div class="col-3">
            
                                        </div>
                                        <div class="col-6">
                                            {{search_bar|crispy}}
                                        </div>
                                        <div class="col-3">
                                            <button type="submit" class="btn btn-outline-success"><i class="bi bi-search"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-4 d-flex justify-content-end">
                            <div class="row">
                                <div class="col-6">
                                    <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasnav" aria-controls="offcanvasnav" style="height: 40px; width: fit-content;">
                                        <div class="fs-2"><i class="bi bi-list" style="color: #198754;"></i></div>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasnotify" aria-controls="staticBackdrop">
                                        <div class="fs-2"><i class="bi bi-bell-fill" id="bell-icon" style="color: #198754;"></i></div>
                                        <span class="top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notification-counter">{{ notification_count }}</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
        </nav>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasnav" aria-labelledby="offcanvasnav">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasExampleLabel"><p class="lead">More</p></h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div class="container">
                    <div class="row">
                        <div class="col-12 p-2">
                            <ul>
                                <li class="custom-icon"><div class="fs-4"><i class="bi bi-person" style="color: #787878;"></i></div> <a href="/profile/{{username}}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Profile</p></a></li>
                                <li class="custom-icon"><div class="fs-4"><i class="bi bi-rss-fill" style="color: #787878;"></i></div> <a href="/page/recommended|All/1" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Feed</p></a></li>
                                <li class="custom-icon"><div class="fs-4"><i class="bi bi-chat-text" style="color: #787878;"></i></div> <a href="/chat/" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Messages</p></a></li>
                                <li class="custom-icon"><div class="fs-4"><i class="bi bi-gear-wide-connected" style="color: #787878;"></i></div> <a href="/settings/{{username}}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Settings</p></a></li>
                                <li class="custom-icon"><div class="fs-4"><i class="bi bi-box-arrow-right" style="color: #787878;" ></i></div> <a href="/logout/" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Logout</p></a></li>                       
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="offcanvas offcanvas-end" data-bs-backdrop="static" tabindex="-1" id="offcanvasnotify" aria-labelledby="staticBackdropLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title">Notifications</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div id="notification-inbox" style="overflow-y: auto;">
                    <!-- loops though all notifications sent to the document -->
                    {% for notification in notifications.values %}
                    <div id="notification-{{notification.notification_object.pk}}" class="card mb-2" aria-live="assertive" aria-atomic="true" data-bs-autohide="false">
                        <div class="card-header">
                            <button class="btn p-0" onclick='location.href="/chat/{{notification.notification_object.source.name}}/{{notification.notification_object.source.pk}}"' id="read-notification-{{notification.notification_object.pk}}">
                                <img src="{{notification.notification_object.source.icon.url}}" class="rounded me-2" alt="" style="height: 2.5rem; width: 2.5rem">
                            </button>
                            <button class="btn p-0 pe-2" onclick="location.href='/chat/{{notification.notification_object.source.name}}/{{notification.notification_object.source.pk}}'" id="read-notification-{{notification.notification_object.pk}}">
                                <strong class="me-auto">{{notification.notification_object.source.name}}</strong>
                            </button>
                            <small class="text-muted pe-2">{{notification.notification_object.timestamp}}</small>
                            <button type="button ms-2" class="btn-close" id="close-notification-{{notification.notification_object.pk}}" aria-label="Close"></button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <img src="{{notification.sender_pfp_url}}" class="rounded me-2" alt="" style="height: 2.5rem; width: 2.5rem">
                                    <em>{{notification.notification_object.sender}}</em>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col mt-2">
                                    {% if notification.notification_object.relevant_message.text %}
                                        <p class="text-truncate">{{notification.notification_object.contents}}</p>
                                    {% else %}
                                        {% if notification.notification_object.relevant_message.reply %}
                                            {% if notification.notification_object.relevant_message.image %}
                                                <p class="text-truncate">({{notification.notification_object.relevant_message.sender.user.username}} Replied to You): <strong>Image</strong></p>
                                            {% else %}
                                                <p class="text-truncate">({{notification.notification_object.relevant_message.sender.user.username}} Replied to You): <strong>Video</strong></p>
                                            {% endif %}
                                        {% else %}
                                            <p class="text-truncate"><strong>{{notification.notification_object.contents}}</strong></p>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- script for removing notifications if a user dismisses the notification or chjecks out the notification. -->
                    <script> 
                        $(document).ready(function () {
                            $('#close-notification-{{notification.notification_object.pk}}').click(function () {
                                $.ajax({
                                    type: 'POST',
                                    url: '/universal/remove-notification/',
                                    data: {
                                        'receiver': '{{username}}',
                                        'type': 'notification-id',
                                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                                        'notification_id': '{{notification.notification_object.pk}}'
                                    },
                                    success: function(response) {
                                        console.log(response.notification_count, response.notification_counter)
                                        var notification = $("#notification-{{notification.notification_object.pk}}")
                                        notification.remove();
                                        $('#notification-counter').text('');
                                        $('#notification-counter').text(response.notification_count);
                                            if (response.notification_count == 0) {
                                                $('#notification-counter').text(response.notification_count).hide();
                                                $('#notification-counter').remove();
                                                $('#bell-icon').removeClass('bi-bell-fill');
                                                $('#bell-icon').addClass('bi-bell');
                                            }
                                    }
                                })
                            })
                            $('#read-notification-{{notification.notification_object.pk}}').click(function () {
                                $.ajax({
                                    type: 'POST',
                                    url: '/universal/remove-notification/',
                                    data: {
                                        'receiver': '{{username}}',
                                        'type': 'notification-id',
                                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                                        'notification_id': '{{notification.notification_object.pk}}'
                                    },
                                    success: function(response) {
                                        console.log(response.message)
                                    }
                                })
                            })
                        })
                    </script>
                {% endfor %}
                </div>
            </div>
        </div>
        <br>
        <br>
        <div class="row">
            <div class="col-12">
                <div class="card m-5">
                    <div class="row">
                        <div class="col m-2">
                            <button class="btn btn-light"><img src="{{user_stats.pfp.url}}", onclick='location.href = "/profile/{{user_stats.user.username}}"' style="width: 30px; height: 30px;"></button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m-2">
                            <h6 class="display-6">{{post.user}}</h6>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m-2">
                            <img src="{{post.media.url}}" alt="{{post.id}}'s Media" style="height: 248px; width: 100%;">
                        </div>
                    </div>
                    <div class="row m-2">
                        <div class="col">
                            <h3 class="display-6">{{post.title}}</h3>
                        </div>
                    </div>
                    <div class="row m-1">
                        <div class="col">
                            <p class="lead">{{post.contents}}</p>
                        </div>
                    </div>
                    <div class="row m-1">
                        <div class="col-6 d-flex justify-content-start">
                            <button type="button" class="btn" data-bs-target="#expand-{{post.id}}", data-bs-toggle="modal"><i class="bi bi-three-dots"></i></button>
                        </div>
                        <div class="col-6 d-flex justify-content-end">
                            <form action="" id="post-form" method="post">
                                {% if user_liked_by in post.liked_by.all %}
                                <button type="submit" id="like{{post.id}}" class="btn btn-success border border-success page-like-button-{{post.id}} d-flex align-items-center pb-3 pt-2" data-post-id="{{post.id}}" style="height: 25px;">
                                    <div class="row align-items-center">
                                        <div class="col mt-1 d-flex justify-content-end">
                                            <i class="bi bi-hand-thumbs-up-fill" id="page-like-icon-{{post.id}}" style="color: #ffffff;"></i>
                                        </div>
                                        <div class="col mt-4">
                                            <p class="text-white" id="page-like-text-{{post.id}}">{{post.likes}}</p>
                                        </div>
                                    </div>
                                </button>
                                {% else %}
                                <button type="submit" id="like{{post.id}}" class="btn border border-success page-like-button-{{post.id}} d-flex align-items-center pb-3 pt-2" data-post-id="{{post.id}}" style="height: 25px;">
                                    <div class="row align-items-center">
                                        <div class="col mt-1 d-flex justify-content-end">
                                            <i class="bi bi-hand-thumbs-up" id="page-like-icon-{{post.id}}" style="color: #198754;"></i>
                                        </div>
                                        <div class="col mt-4">
                                            <p class="text-success" id="page-like-text-{{post.id}}">{{post.likes}}</p>
                                        </div>
                                    </div>
                                </button>
                                {% endif %}
                                <script>
                                    document.addEventListener('DOMContentLoaded', function() {
                                        $('.page-like-button-{{post.id}}').click(function() { // When the button is pressed
                                            console.log('clicked');
                                            var postId = $(this).data('post-id'); // Get Post ID
                                            console.log('Post ID:', postId);
                                        
                                            // Defining variables
                                            var modalClickedButton = $('.modal-like-button-{{post.id}}'); 
                                            var pageClickedButton = $('.page-like-button-{{post.id}}');
                                            var isLiked
                                            var modalLikeCounter
                                            var pageLikeCounter
                                            var modalLikeIcon
                                            var pageLikeIcon
                                            console.log('defined');
                                            console.log(isLiked)

                                            // AJAX request
                                            $.ajax({
                                                type: 'POST',
                                                url: '/page/liked/',
                                                data: {
                                                    'post_id': postId,
                                                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                },
                                                
                                                // If the request was successful
                                                success: function(response) {
                                                    console.log('success');

                                                    // Getting relevent elements
                                                    modalLikeCounter = $('#modal-like-text-{{post.id}}');
                                                    pageLikeCounter = $('#page-like-text-{{post.id}}')
                                                    modalLikeIcon = $('#modal-like-icon-{{post.id}}');
                                                    pageLikeIcon = $('#page-like-icon-{{post.id}}')

                                                    // Changing text
                                                    modalLikeCounter.text(response.likes);
                                                    pageLikeCounter.text(response.likes);
                                                    
                                                    // Different style changes for different like statuses
                                                    if (response.isLiked) {
                                                        console.log('like');

                                                        
                                                        // Change classes for dislike state
                                                        modalLikeCounter.removeClass('text-success').addClass('text-white');
                                                        modalLikeIcon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                        modalClickedButton.removeClass('liked-button').addClass('btn-success');
                                                        
                                                        pageLikeCounter.removeClass('text-success').addClass('text-white');
                                                        pageLikeIcon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                        pageClickedButton.removeClass('liked-button').addClass('btn-success');

                                                        // Color change
                                                        modalLikeIcon = document.getElementById('modal-like-icon-{{post.id}}')
                                                        modalLikeIcon.style.color = '#ffffff'
                                                        
                                                        pageLikeIcon = document.getElementById('page-like-icon-{{post.id}}')
                                                        pageLikeIcon.style.color = '#ffffff'

                                                    } else {
                                                        console.log('dislike');

                                                        // Change classes for like state
                                                        modalLikeCounter.removeClass('text-white').addClass('text-success');
                                                        modalLikeIcon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                        modalClickedButton.removeClass('btn-success').addClass('liked-button');
                                                        
                                                        pageLikeCounter.removeClass('text-white').addClass('text-success');
                                                        pageLikeIcon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                        pageClickedButton.removeClass('btn-success').addClass('liked-button');


                                                        // Color change
                                                        modalLikeIcon = document.getElementById('modal-like-icon-{{post.id}}')
                                                        modalLikeIcon.style.color = '#198754'
                                                        pageLikeIcon = document.getElementById('page-like-icon-{{post.id}}')
                                                        pageLikeIcon.style.color = '#198754'
                                                    }
                                                },
                                                error: function(xhr, errmsg, err) {
                                                    console.log('Error:', xhr.ststus, xhr.statusText);
                                                },
                                                beforeSend: function(xhr, settings) {
                                                    console.log('Before send:', settings);
                                                    console.log('i.hasContent:', settings.hasContent);
                                                    console.log('i.data:', settings.data);
                                                }
                                            });
                                        });
                                        $(document).on('submit', '#post-form', function(e) {
                                            e.preventDefault(); // Prevents reloading of the website
                                            console.log('prevented');
                                        });
                                    });
                                </script>
                            </form>    
                        </div>
                    </div>    
                </div>
                <!-- modal -->
                <div id="expand-{{post.id}}" class="modal fade">
                    <div class="modal-dialog" style="max-width: 56%;">
                        <div class="modal-content">
                            <div class="modal-header">
                                Post
                                <button class="btn btn-close" data-bs-dismiss="modal" data-bs-target="#post-{{post.id}}"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col m-2">
                                        {% for key, value in post_users.items %}
                                            {% if key|stringformat:"%s%s" == post.user|stringformat:"%s%s" %}
                                                <button class="btn btn-light" style="border-radius: 15px; width: fit-content; height: fit-content;"><img src="{{ value }}", onclick='location.href = "/profile/{{post.user}}"' style="width: 30px; height: 30px;"></button>
                                            {% else %}
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col m-2">
                                        <h6 class="display-6">{{post.user}}</h6>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col m-2">
                                        <img src="{{post.media.url}}" alt="{{post.id}}'s Media" style="height: 248px; width: 100%;">
                                    </div>
                                </div>
                                <div class="row m-2">
                                    <div class="col">
                                        <h3 class="display-6">{{post.title}}</h3>
                                    </div>
                                </div>
                                <div class="row m-1">
                                    <div class="col">
                                        <p class="lead">{{post.contents}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-4">
                                        <a class="btn btn-success" data-bs-toggle="collapse" href="#liked-by-{{post.id}}" role="button" aria-expanded="false" aria-controls="liked-by-{{post.id}}">Liked By</a> 
                                    </div>
                                    <div class="col-8 d-flex justify-content-end">
                                        <form action="" id="post-form" method="post">
                                            {% if user_liked_by in post.liked_by.all %}
                                                <button type="submit" id="like{{post.id}}" class="btn btn-success border border-success modal-like-button-{{post.id}} d-flex align-items-center pb-3 pt-2" data-post-id="{{post.id}}" style="height: 25px;">
                                                    <div class="row align-items-center">
                                                        <div class="col mt-1 d-flex justify-content-end">
                                                            <i class="bi bi-hand-thumbs-up-fill" id="modal-like-icon-{{post.id}}" style="color: #ffffff;"></i>
                                                        </div>
                                                        <div class="col mt-4">
                                                            <p class="text-white" id="modal-like-text-{{post.id}}">{{post.likes}}</p>
                                                        </div>
                                                    </div>
                                                </button>
                                                {% else %}
                                                <button type="submit" id="like{{post.id}}" class="btn border border-success modal-like-button-{{post.id}} d-flex align-items-center pb-3 pt-2" data-post-id="{{post.id}}" style="height: 25px;">
                                                    <div class="row align-items-center">
                                                        <div class="col mt-1 d-flex justify-content-end">
                                                            <i class="bi bi-hand-thumbs-up" id="modal-like-icon-{{post.id}}" style="color: #198754;"></i>
                                                        </div>
                                                        <div class="col mt-4">
                                                            <p class="text-success" id="modal-like-text-{{post.id}}">{{post.likes}}</p>
                                                        </div>
                                                    </div>
                                                </button>
                                                {% endif %}
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', function() {
                                                        $('.modal-like-button-{{post.id}}').click(function() { // When the button is pressed
                                                            console.log('clicked');
                                                            var postId = $(this).data('post-id'); // Get Post ID
                                                            console.log('Post ID:', postId);
                                                            
                                                            // Defining variables
                                                            var modalClickedButton = $('.modal-like-button-{{post.id}}'); 
                                                            var pageClickedButton = $('.page-like-button-{{post.id}}');
                                                            var isLiked
                                                            var modalLikeCounter
                                                            var pageLikeCounter
                                                            var modalLikeIcon
                                                            var pageLikeIcon
                                                            console.log('defined');
                        
                                                            // AJAX request
                                                            $.ajax({
                                                                type: 'POST',
                                                                url: '/page/liked/',
                                                                data: {
                                                                    'post_id': postId,
                                                                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                                },
                                                                
                                                                // If the request was successful
                                                                success: function(response) {
                                                                    console.log('success');
                        
                                                                    // Getting relevent elements
                                                                    modalLikeCounter = $('#modal-like-text-{{post.id}}');
                                                                    pageLikeCounter = $('#page-like-text-{{post.id}}')
                                                                    modalLikeIcon = $('#modal-like-icon-{{post.id}}');
                                                                    pageLikeIcon = $('#page-like-icon-{{post.id}}')
                        
                                                                    // Changing text
                                                                    modalLikeCounter.text(response.likes);
                                                                    pageLikeCounter.text(response.likes);
                                                                    
                                                                    // Different style changes for different like statuses
                                                                    if (response.isLiked) {
                                                                        console.log('like');
                        
                                                                        
                                                                        // Change classes for dislike state
                                                                        modalLikeCounter.removeClass('text-success').addClass('text-white');
                                                                        modalLikeIcon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                                        modalClickedButton.removeClass('liked-button').addClass('btn-success');
                                                                        
                                                                        pageLikeCounter.removeClass('text-success').addClass('text-white');
                                                                        pageLikeIcon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                                        pageClickedButton.removeClass('liked-button').addClass('btn-success');
                        
                                                                        // Color change
                                                                        modalLikeIcon = document.getElementById('modal-like-icon-{{post.id}}')
                                                                        modalLikeIcon.style.color = '#ffffff'
                                                                        
                                                                        pageLikeIcon = document.getElementById('page-like-icon-{{post.id}}')
                                                                        pageLikeIcon.style.color = '#ffffff'
                        
                                                                    } else {
                                                                        console.log('dislike');
                        
                                                                        // Change classes for like state
                                                                        modalLikeCounter.removeClass('text-white').addClass('text-success');
                                                                        modalLikeIcon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                                        modalClickedButton.removeClass('btn-success').addClass('liked-button');
                                                                        
                                                                        pageLikeCounter.removeClass('text-white').addClass('text-success');
                                                                        pageLikeIcon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                                        pageClickedButton.removeClass('btn-success').addClass('liked-button');
                        
                        
                                                                        // Color change
                                                                        modalLikeIcon = document.getElementById('modal-like-icon-{{post.id}}')
                                                                        modalLikeIcon.style.color = '#198754'
                                                                        pageLikeIcon = document.getElementById('page-like-icon-{{post.id}}')
                                                                        pageLikeIcon.style.color = '#198754'
                                                                    }
                                                                },
                                                                error: function(xhr, errmsg, err) {
                                                                    console.log('Error:', xhr.ststus, xhr.statusText);
                                                                },
                                                                beforeSend: function(xhr, settings) {
                                                                    console.log('Before send:', settings);
                                                                    console.log('i.hasContent:', settings.hasContent);
                                                                    console.log('i.data:', settings.data);
                                                                }
                                                            });
                                                        });
                                                        $(document).on('submit', '#post-form', function(e) {
                                                            e.preventDefault(); // Prevents reloading of the website
                                                            console.log('prevented');
                                                        });
                                                    });
                                                </script>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="collapse card m-1" id="liked-by-{{post.id}}">
                                                <ul class="list-group list-group-flush">
                                                    {% for likedby in post.liked_by.all %}
                                                        <li class="list-group-item"> > {{ likedby }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col text-center">
                                            <p class="lead">Date Created: {{post.created_at}}</p>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col">
                                            <p class="lead text-center">Comments:</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col d-flex justify-content-center">
                                            <!-- Comments form -->
                                            <form method="post" id="comment-form-{{post.id}}">
                                                {% csrf_token %}
                                                {{comment_form | crispy}}
                                                <button type="button" id="add-comment-{{post.id}}" class="btn btn-success" data-post-id="{{post.id}}">Add</button>
                                            </form>
                                            <!-- Script gets items from form, creates the comment, then displays it inside of the relevent post. -->
                                            <script>
                                                document.addEventListener('DOMContentLoaded', function() {
                                                    document.getElementById('add-comment-{{post.id}}').addEventListener('click', function() {
                                                        var postId = $(this).data('post-id');
                                                        var text = $('#comment-form-{{post.id}} #comment_text').val();
                                                        console.log(postId, text)
                                                        $.ajax({
                                                            type: 'POST',
                                                            url: '/page/new_comment/',
                                                            data: {
                                                                'post_id': postId,
                                                                'text': text,
                                                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                            },

                                                            success: function(response) {
                                                                console.log('success')
                                                                $('#comments-container-{{post.id}}').prepend(
                                                                    '<div class="row">' +
                                                                        '<div class="col">' +
                                                                            '<div class="card p-3 m-2">' +
                                                                                '<div class="row">' +
                                                                                    '<div class="col">' +
                                                                                        '<img class="border border-success" src="'+ response.pfp + '" alt="" style="height:20px; width: 20px; border-radius: 10px;">' +
                                                                                        '<strong> ' + response.user + '</strong>' +
                                                                                    '</div>' +
                                                                                '</div>' +
                                                                                '<div class="row">' +
                                                                                    '<div class="col">' +
                                                                                        response.text +
                                                                                    '</div>' +
                                                                                '</div>' +
                                                                                '<div class="row">' +
                                                                                    '<div class="col-10">' +
                                                                                        '<a href="#nested-comments-' + response.id + '" data-bs-toggle="collapse" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Replies</a>' +
                                                                                        '<div class="collapse" id="nested-comments-'+ response.id +'">' +
                                                                                            '<br>' +
                                                                                        '</div>' +
                                                                                    '</div>' +
                                                                                    '<div class="col d-flex justify-content-end">' +
                                                                                        '<button type="submit" id="like'+ response.id +'" class="btn border border-success comment-like-button-'+ response.id +' d-flex align-items-center pb-3 pt-2" data-comment-id="'+ response.id +'" style="height: 25px;">' +
                                                                                            '<div class="row align-items-center">' +
                                                                                                '<div class="col mt-1 d-flex justify-content-end">' +
                                                                                                    '<i class="bi bi-hand-thumbs-up" id="comment-like-icon-'+ response.id +'" style="color: #198754;"></i>' +
                                                                                                '</div>' +
                                                                                                '<div class="col mt-4">' +
                                                                                                    '<p class="text-success" id="comment-like-text-'+ response.id +'">'+ response.likes +'</p>' +
                                                                                                '</div>' +
                                                                                            '</div>' +
                                                                                        '</button>' +
                                                                                        '</div>' +
                                                                                    '<br>' +
                                                                                '</div>' +
                                                                            '</div>' +
                                                                        '</div>' +
                                                                    '</div>' +
                                                                '<script>' +
                                                                    '$(document).ready( function() {\n\n' +
                                                                        '$(\'.comment-like-button-'+ response.id +'\').click(function() {\n\n' +
                                                                            'console.log(\'clicked\');\n\n' +
                                                                            'var commentId = $(this).data(\'comment-id\');\n\n' +
                                                                            'console.log(\'Comment ID:\', commentId);\n\n' +
                                                                            'var button = $(\'.comment-like-button-'+ response.id +'\');\n\n' +
                                                                            'var counter;\n\n' +
                                                                            'var icon;\n\n' +
                                                                            '$.ajax({\n\n' +
                                                                                'type: \'POST\',\n\n' +
                                                                                'url: \'/page/comment-liked/\',\n\n' +
                                                                                'data: {' +
                                                                                    '\'comment_id\': commentId,\n\n' +
                                                                                    '\'comment_type\': \'comment\',\n\n' +
                                                                                    '\'csrfmiddlewaretoken\': \'{{ csrf_token }}\'\n\n' +
                                                                                '},\n\n' +
                                                                                'success: function(response) {\n\n' +
                                                                                    'console.log(\'success\');\n\n' +
                                                                                    'counter = $(\'#comment-like-text-'+ response.id +'\');\n\n' +
                                                                                    'icon = $(\'#comment-like-icon-'+ response.id +'\');\n\n' +
                                                                                    'counter.text(response.likes);\n\n' +
                                                                                    'if (response.isLiked) {\n\n' +
                                                                                        'console.log(\'like\');\n\n' +
                                                                                        'counter.removeClass(\'text-success\').addClass(\'text-white\');\n\n' +
                                                                                        'icon.removeClass(\'bi-hand-thumbs-up\').addClass(\'bi-hand-thumbs-up-fill\');\n\n' +
                                                                                        'button.removeClass(\'liked-button\').addClass(\'btn-success\');\n\n' +
                                                                                        'icon = document.getElementById(\'comment-like-icon-'+ response.id +'\');\n\n' +
                                                                                        'icon.style.color = \'#ffffff\';\n\n' +
                                                                                    '} else {\n\n' +
                                                                                        'console.log(\'dislike\');\n\n' +
                                                                                        'counter.removeClass(\'text-white\').addClass(\'text-success\');\n\n' +
                                                                                        'icon.removeClass(\'bi-hand-thumbs-up-fill\').addClass(\'bi-hand-thumbs-up\');\n\n' +
                                                                                        'button.removeClass(\'btn-success\').addClass(\'liked-button\');\n\n' +
                                                                                        'icon = document.getElementById(\'comment-like-icon-'+ response.id +'\');\n\n' +
                                                                                        'icon.style.color = \'#198754\';\n\n' +
                                                                                    '}\n\n' +
                                                                                '},\n\n' +
                                                                                'error: function(xhr, errmsg, err) {\n\n' +
                                                                                    'console.log(\'Error:\', xhr.status, xhr.statusText);\n\n' +
                                                                                '},\n\n' +
                                                                                'beforeSend: function(xhr, settings) {\n\n' +
                                                                                    'console.log(\'Before send:\', settings);\n\n' +
                                                                                    'console.log(\'i.hasContent:\', settings.hasContent);\n\n' +
                                                                                    'console.log(\'i.data:\', settings.data);\n\n' +
                                                                                '}\n\n' +
                                                                            '});\n\n' +
                                                                        '});\n\n' +
                                                                    '});\n\n' 
                                                                );
                                                            },
                                                        });
                                                    });
                                                });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                                <!-- comments -->
                                <div id="comments-container-{{post.id}}">
                                    {% for commentPk, commentData  in post_comments.items %}
                                        {% if commentData.post_id|stringformat:"%s%s" == post.id|stringformat:"%s%s" %}
                                            <div class="row">
                                                <div class="col">
                                                    <div class="card p-3 m-2">
                                                        <div class="row">
                                                            <div class="col">
                                                                {% for user_key, user_value in post_users.items %}
                                                                    {% if user_key|stringformat:"%s%s" == commentData.user|stringformat:"%s%s" %}
                                                                        <img class="border border-success" src="{{user_value}}" alt="" style="height:20px; width: 20px; border-radius: 10px;">
                                                                        <strong>{{commentData.user}}</strong>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col">
                                                                {{ commentData.text }} 
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-10">
                                                                <a href="#nested-comments-{{commentPk}}" data-bs-toggle="collapse" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Replies</a>
                                                                <div class="collapse" id="nested-comments-{{commentPk}}">
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <!-- For repling -->
                                                                            <form action="" method="post" id="reply-form-{{commentPk}}">
                                                                                {% csrf_token %}
                                                                                {{comment_form | crispy}}
                                                                                <button type="button" id="add-reply-{{commentPk}}" class="btn btn-success" data-comment-id="{{commentPk}}">Reply</button>
                                                                            </form>
                                                                            <!-- Same processing tecnique for replies -->
                                                                            <script>
                                                                                document.addEventListener('DOMContentLoaded', function() {
                                                                                    $('#add-reply-{{commentPk}}').click(function() {
                                                                                        var commentId = $(this).data('comment-id');
                                                                                        var text = $('#reply-form-{{commentPk}} #comment_text').val();
                                                                                        console.log(commentId, text);
                                                                                        $.ajax({
                                                                                            type: 'POST',
                                                                                            url: '/page/new_reply/',
                                                                                            data: {
                                                                                                'comment_id': commentId,
                                                                                                'text': text,
                                                                                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                                                            },
                                                                                        
                                                                                            success: function(response) {
                                                                                                console.log('success')
                                                                                                console.log(response.reply_id)
                                                                                                $('#replies-container-'+ response.comment_id).prepend(
                                                                                                    '<div class="row">' +
                                                                                                        '<div class="col">' +
                                                                                                            '<div class="card p-1">' +
                                                                                                                '<div class="row">' +
                                                                                                                    '<div class="col">' +
                                                                                                                        '<img class="border border-success" src="'+ response.pfp +'" alt="" style="height:20px; width: 20px; border-radius: 10px;">' +
                                                                                                                        '<em> '+ response.user +'</em>' +
                                                                                                                    '</div>' +
                                                                                                                '</div>' +
                                                                                                                '<div class="row">' +
                                                                                                                    '<div class="col">' +
                                                                                                                        response.text +
                                                                                                                    '</div>' +
                                                                                                                    '<div class="col d-flex justify-content-end">' +
                                                                                                                        '<button type="submit" id="like'+ response.reply_id +'" class="btn border border-success nested-comment-like-button-'+ response.reply_id +' d-flex align-items-center pb-3 pt-2" data-comment-id="'+ response.reply_id +'" style="height: 25px;">' +
                                                                                                                            '<div class="row align-items-center">' +
                                                                                                                                '<div class="col mt-1 d-flex justify-content-end">' +
                                                                                                                                    '<i class="bi bi-hand-thumbs-up" id="nested-comment-like-icon-'+ response.reply_id +'" style="color: #198754;"></i>' +
                                                                                                                                '</div>' +
                                                                                                                                '<div class="col mt-4">' +
                                                                                                                                    '<p class="text-success" id="nested-comment-like-text-'+ response.reply_id +'">'+ response.likes +'</p>' +
                                                                                                                                '</div>' +
                                                                                                                            '</div>' +
                                                                                                                        '</button>' +
                                                                                                                    '</div>' +
                                                                                                                '</div>' +
                                                                                                            '</div>' +
                                                                                                            '<br>'+
                                                                                                        '</div>' +
                                                                                                    '</div>' +
                                                                                                '<script>' +
                                                                                                    '$(\'.nested-comment-like-button-'+ response.reply_id +'\').click(function() { \n\n' +
                                                                                                        'console.log(\'clicked\');\n' +
                                                                                                        'var commentId = $(this).data(\'comment-id\');\n' +
                                                                                                        'console.log(\'Comment ID:\', commentId);\n' +
                                                                                                        'var button = $(\'.nested-comment-like-button-'+ response.reply_id +'\');\n' +
                                                                                                        'var counter;\n' +
                                                                                                        'var icon;\n' +
                                                                                                        '$.ajax({ \n' +
                                                                                                            'type: \'POST\', \n' +
                                                                                                            'url: \'/page/comment-liked/\', \n' +
                                                                                                            'data: { \n' +
                                                                                                                '\'comment_id\': commentId, \n' +
                                                                                                                '\'comment_type\': \'nested-comment\', \n' +
                                                                                                                '\'csrfmiddlewaretoken\': \'{{ csrf_token }}\' \n' +
                                                                                                            '}, \n' +
                                                                                                            'success: function(response) { \n' +
                                                                                                                'console.log(\'success\');\n' +
                                                                                                                'counter = $(\'#nested-comment-like-text-'+ response.reply_id +'\');\n' +
                                                                                                                'icon = $(\'#nested-comment-like-icon-'+ response.reply_id +'\');\n' +
                                                                                                                'counter.text(response.likes);\n' +
                                                                                                                'if (response.isLiked) { \n' +
                                                                                                                    'console.log(\'like\');\n' +
                                                                                                                    'counter.removeClass(\'text-success\').addClass(\'text-white\');\n' +
                                                                                                                    'icon.removeClass(\'bi-hand-thumbs-up\').addClass(\'bi-hand-thumbs-up-fill\');\n' +
                                                                                                                    'button.removeClass(\'liked-button\').addClass(\'btn-success\');\n' +
                                                                                                                    'icon.css(\'color\', \'#ffffff\');\n' +
                                                                                                                '} else { \n' +
                                                                                                                    'console.log(\'dislike\');\n' +
                                                                                                                    'counter.removeClass(\'text-white\').addClass(\'text-success\');\n' +
                                                                                                                    'icon.removeClass(\'bi-hand-thumbs-up-fill\').addClass(\'bi-hand-thumbs-up\');\n' +
                                                                                                                    'button.removeClass(\'btn-success\').addClass(\'liked-button\');\n' +
                                                                                                                    'icon.css(\'color\', \'#198754\');\n' +
                                                                                                                '} \n' +
                                                                                                            '}, \n' +
                                                                                                            'error: function(xhr, errmsg, err) { \n' +
                                                                                                                'console.log(\'Error:\', xhr.status, xhr.statusText);\n' +
                                                                                                            '}, \n' +
                                                                                                            'beforeSend: function(xhr, settings) { \n' +
                                                                                                                'console.log(\'Before send:\', settings);\n' +
                                                                                                                'console.log(\'i.hasContent:\', settings.hasContent);\n' +
                                                                                                                'console.log(\'i.data:\', settings.data);\n' +
                                                                                                            '} \n' +
                                                                                                        '}); \n' +
                                                                                                    '});'
                                                                                                )
                                                                                            },
                                                                                        },
                                                                                        )
                                                                                    });
                                                                                })
                                                                            </script>
                                                                        </div>
                                                                    </div>
                                                                    <br>
                                                                    <div id="replies-container-{{commentPk}}">
                                                                        {% for subCommentPk, subCommentData in post_replies.items %} 
                                                                            {% if subCommentData.comment_id|stringformat:"%s%s" == commentData.id|stringformat:"%s%s" %}
                                                                                <div class="card p-1">
                                                                                    <div class="row">
                                                                                        <div class="col">
                                                                                            {% for user_key, user_value in post_users.items %}
                                                                                                {% if user_key|stringformat:"%s%s" == subCommentData.user|stringformat:"%s%s" %}
                                                                                                    <img class="border border-success" src="{{user_value}}" alt="" style="height:20px; width: 20px; border-radius: 10px;">
                                                                                                    <em>{{ subCommentData.user }}</em>
                                                                                                {% endif %}
                                                                                            {% endfor %}
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="row">
                                                                                        <div class="col">
                                                                                            {{subCommentData.text}}
                                                                                        </div>
                                                                                        <div class="col d-flex justify-content-end">
                                                                                            {% if user_liked_by in subCommentData.liked__by.all %}
                                                                                                <button type="submit" id="like{{subCommentPk}}" class="btn btn-success border border-success nested-comment-like-button-{{subCommentPk}} d-flex align-items-center pb-3 pt-2" data-comment-id="{{subCommentPk}}" style="height: 25px;">
                                                                                                    <div class="row align-items-center">
                                                                                                        <div class="col mt-1 d-flex justify-content-end">
                                                                                                            <i class="bi bi-hand-thumbs-up-fill" id="nested-comment-like-icon-{{subCommentPk}}" style="color: #ffffff;"></i>
                                                                                                        </div>
                                                                                                        <div class="col mt-4">
                                                                                                            <p class="text-white" id="nested-comment-like-text-{{subCommentPk}}">{{subCommentData.likes}}</p>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </button>
                                                                                            {% else %}
                                                                                                <button type="submit" id="nested-comment-like-button-{{subCommentPk}}" class="btn border border-success nested-comment-like-button-{{subCommentPk}} d-flex align-items-center pb-3 pt-2" data-comment-id="{{subCommentPk}}" style="height: 25px;">
                                                                                                    <div class="row align-items-center">
                                                                                                        <div class="col mt-1 d-flex justify-content-end">
                                                                                                            <i class="bi bi-hand-thumbs-up" id="nested-comment-like-icon-{{subCommentPk}}" style="color: #198754;"></i>
                                                                                                        </div>
                                                                                                        <div class="col mt-4">
                                                                                                            <p class="text-success" id="nested-comment-like-text-{{subCommentPk}}">{{subCommentData.likes}}</p>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </button>
                                                                                            {% endif %}
                                                                                            <script>
                                                                                                $(document).ready( function() {
                                                                                                    $('#nested-comment-like-button-{{subCommentPk}}').click(function() { // When the button is pressed
                                                                                                        console.log('clicked');
                                                                                                        var commentId = $(this).data('comment-id');
                                                                                                        console.log('Comment ID:', commentId);

                                                                                                        // Defining variables
                                                                                                        var button = $('.nested-comment-like-button-{{subCommentPk}}');
                                                                                                        var counter;
                                                                                                        var icon;

                                                                                                        // AJAX
                                                                                                        $.ajax({
                                                                                                            type: 'POST',
                                                                                                            url: '/page/comment-liked/',
                                                                                                            data: {
                                                                                                                'comment_id': commentId,
                                                                                                                'comment_type': 'nested-comment',
                                                                                                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                                                                            },
                                                                                                            success: function(response) {
                                                                                                                console.log('success');

                                                                                                                // Getting relevant elements
                                                                                                                counter = $('#nested-comment-like-text-{{subCommentPk}}');
                                                                                                                icon = $('#nested-comment-like-icon-{{subCommentPk}}');

                                                                                                                // Changing text
                                                                                                                counter.text(response.likes);

                                                                                                                // Different styles for if the comment was liked or not
                                                                                                                if (response.isLiked) {
                                                                                                                    console.log('like');

                                                                                                                    // Change classes for dislike state
                                                                                                                    counter.removeClass('text-success').addClass('text-white');
                                                                                                                    icon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                                                                                    button.removeClass('liked-button').addClass('btn-success');

                                                                                                                    // Color change
                                                                                                                    icon.css('color', '#ffffff');

                                                                                                                } else {
                                                                                                                    console.log('dislike');

                                                                                                                    // Change classes for dislike state
                                                                                                                    counter.removeClass('text-white').addClass('text-success');
                                                                                                                    icon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                                                                                    button.removeClass('btn-success').addClass('liked-button');

                                                                                                                    // Color change
                                                                                                                    icon.css('color', '#198754');                                                                      
                                                                                                                }
                                                                                                            },
                                                                                                            error: function(xhr, errmsg, err) {
                                                                                                                console.log('Error:', xhr.status, xhr.statusText);
                                                                                                            },
                                                                                                            beforeSend: function(xhr, settings) {
                                                                                                                console.log('Before send:', settings);
                                                                                                                console.log('i.hasContent:', settings.hasContent);
                                                                                                                console.log('i.data:', settings.data);
                                                                                                            }
                                                                                                        });
                                                                                                    });
                                                                                                });
                                                                                            </script>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <br>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col d-flex justify-content-end">
                                                                {% if user_liked_by in subCommentData.liked__by.all %}
                                                                    <button type="submit" id="like{{commentPk}}" class="btn btn-success border border-success comment-like-button-{{commentPk}} d-flex align-items-center pb-3 pt-2" data-comment-id="{{commentPk}}" style="height: 25px;">
                                                                        <div class="row align-items-center">
                                                                            <div class="col mt-1 d-flex justify-content-end">
                                                                                <i class="bi bi-hand-thumbs-up-fill" id="comment-like-icon-{{commentPk}}" style="color: #ffffff;"></i>
                                                                            </div>
                                                                            <div class="col mt-4">
                                                                                <p class="text-white" id="comment-like-text-{{commentPk}}">{{commentData.likes}}</p>
                                                                            </div>
                                                                        </div>
                                                                    </button>
                                                                {% else %}
                                                                    <button type="submit" id="like{{commentPk}}" class="btn border border-success comment-like-button-{{commentPk}} d-flex align-items-center pb-3 pt-2" data-comment-id="{{commentPk}}" style="height: 25px;">
                                                                        <div class="row align-items-center">
                                                                            <div class="col mt-1 d-flex justify-content-end">
                                                                                <i class="bi bi-hand-thumbs-up" id="comment-like-icon-{{commentPk}}" style="color: #198754;"></i>
                                                                            </div>
                                                                            <div class="col mt-4">
                                                                                <p class="text-success" id="comment-like-text-{{commentPk}}">{{commentData.likes}}</p>
                                                                            </div>
                                                                        </div>
                                                                    </button>
                                                                {% endif %}
                                                                <script>
                                                                    document.addEventListener('DOMContentLoaded', function() {
                                                                        $('.comment-like-button-{{commentPk}}').click(function() { // When the button is pressed
                                                                            console.log('clicked');
                                                                            var commentId = $(this).data('comment-id');
                                                                            console.log('Comment ID:', commentId)

                                                                            // Defining variables
                                                                            var button = $('.comment-like-button-{{commentPk}}');
                                                                            var counter
                                                                            var icon

                                                                            // AJAX
                                                                            $.ajax({
                                                                                type: 'POST',
                                                                                url: '/page/comment-liked/',
                                                                                data: {
                                                                                    'comment_id': commentId,
                                                                                    'comment_type': 'comment',
                                                                                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                                                },
                                                                                success: function(response) {
                                                                                    console.log('success');

                                                                                    // Getting relevent elements
                                                                                    counter = $('#comment-like-text-{{commentPk}}')
                                                                                    icon = $('#comment-like-icon-{{commentPk}}')

                                                                                    // Changing text
                                                                                    counter.text(response.likes);

                                                                                        // Different styles for in the comment was liked of not
                                                                                        if (response.isLiked) {
                                                                                            console.log('like');

                                                                                            // Change classes for dislike state
                                                                                            counter.removeClass('text-success').addClass('text-white');
                                                                                            icon.removeClass('bi-hand-thumbs-up').addClass('bi-hand-thumbs-up-fill');
                                                                                            button.removeClass('liked-button').addClass('btn-success');

                                                                                            // Color change
                                                                                            icon = document.getElementById('comment-like-icon-{{commentPk}}');
                                                                                            icon.style.color = '#ffffff';

                                                                                        } else {
                                                                                            console.log('dislike');

                                                                                            // Change classes for dislike state
                                                                                            counter.removeClass('text-white').addClass('text-success');
                                                                                            icon.removeClass('bi-hand-thumbs-up-fill').addClass('bi-hand-thumbs-up');
                                                                                            button.removeClass('btn-success').addClass('liked-button');

                                                                                            // Color change
                                                                                            icon = document.getElementById('comment-like-icon-{{commentPk}}');
                                                                                            icon.style.color = '#198754';                                                                      
                                                                                        }
                                                                                    },
                                                                                    error: function(xhr, errmsg, err) {
                                                                                        console.log('Error:', xhr.ststus, xhr.statusText);
                                                                                    },
                                                                                    beforeSend: function(xhr, settings) {
                                                                                        console.log('Before send:', settings);
                                                                                        console.log('i.hasContent:', settings.hasContent);
                                                                                        console.log('i.data:', settings.data);
                                                                                    }
                                                                                })
                                                                            });
                                                                        })
                                                                    </script>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>   
                                                </div>
                                            {% endif %} 
                                        {% endfor %}
                                    </div>
                                </div>
                            </div> 
                        </div>
                        <!-- Websockets for recieving notifications -->
                        <script type="text/javascript">
                            let notificationSocket;
                            let reconnectionTime = 5000; // time between disconnection and an attempt to reconnect to the websocket

                            function connectNotificationSocket() { // function for connecting to the websocket.
                                notificationSocket = new WebSocket(
                                    'ws://' + window.location.host + '/ws/brordcast-message/'
                                ); // connect to the relevant consumer class: NotificationConsumer

                                notificationSocket.onopen = function(e) {
                                    console.log('connected', e);
                                };

                                notificationSocket.onmessage = function(e) { // when the consumer class sends a message through
                                    console.log('Message coming through!');
                                    const data = JSON.parse(e.data); // reconfigures the data so that it can be used within our function.

                                    if (data.receiver === '{{username}}') { // if the data belongs to this specific user
                                        $('#inbox').append(data.html_notification_popup); // adds HTML to the inbox div, which stores notification toasts
                                        $('#notification-inbox').prepend(data.stored_html_notification); // adds HTML to the notification div that houses the notifications in the off-canvas
                                        
                                        // Update notification count
                                        var notificationCounter = $('#notification-counter');
                                        var newCount = parseInt(notificationCounter.text()) || 0;
                                        notificationCounter.text(newCount + 1).show();
                                        
                                        if ($('#bell-icon').hasClass('bi-bell')) { // if the bell looks like it has 0 notifications
                                            $('#bell-icon').removeClass('bi-bell');
                                            $('#bell-icon').addClass('bi-bell-fill');
                                        }

                                        var notificationElement = document.getElementById('popup-notification-' + data.notification_id); // gets the newly created popup notification toast

                                        if (notificationElement) {
                                            var notification = new bootstrap.Toast(notificationElement); // creates a bootstrap toast
                                            // Show the toast
                                            notification.show();
                                        } else {
                                            console.error('Notification element not found:', 'notification-' + data.notification_id);
                                        }

                                        // Attach event handlers to the newly added notification
                                        attachNotificationEventHandlers(data.notification_id, data.receiver);
                                    } else {
                                        console.log('incorrect user');
                                    }
                                };

                                notificationSocket.onerror = function(e) {
                                    console.error('WebSocket encountered an error:', e);
                                };

                                notificationSocket.onclose = function(e) {
                                    console.error('WebSocket closed unexpectedly:', e);
                                    setTimeout(connectNotificationSocket, reconnectionTime); // attempt a reconnection to this websocket
                                };
                            }

                            function attachNotificationEventHandlers(notificationId, receiver) {
                                $(`#close-notification-${notificationId}`).click(function() {
                                    $.ajax({
                                        type: 'POST',
                                        url: '/universal/remove-notification/',
                                        data: {
                                            'receiver': receiver,
                                            'type': 'notification-id',
                                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                                            'notification_id': notificationId,
                                        },
                                        success: function(response) {
                                            console.log(response.message);
                                            var notification = $(`#stored-notification-${notificationId}`);
                                            notification.remove();
                                            var notificationCounter = $('#notification-counter');
                                            var newCount = parseInt(notificationCounter.text()) - 1;

                                            if (newCount <= 0) {
                                                notificationCounter.text('').hide();
                                                $('#bell-icon').removeClass('bi-bell-fill').addClass('bi-bell');
                                            } else {
                                                notificationCounter.text(newCount);
                                            }
                                        }
                                    });
                                });

                                $(`#read-notification-${notificationId}`).click(function() {
                                    $.ajax({
                                        type: 'POST',
                                        url: '/universal/remove-notification/',
                                        data: {
                                            'receiver': receiver,
                                            'type': 'notification-id',
                                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                                            'notification_id': notificationId,
                                        },
                                        success: function(response) {
                                            console.log(response.message);
                                        }
                                    });
                                });
                            }

                            $(document).ready(function() {
                                if ('{{ notification_count }}' == '0') {
                                    var notification_counter = $('#notification-counter');
                                    notification_counter.text('').hide();
                                    var notification_bell = $('#bell-icon');
                                    notification_bell.removeClass('bi-bell-fill').addClass('bi-bell');
                                } else {
                                    var notificationCounter = $('#notification-counter');
                                    notificationCounter.text('{{ notification_count }}').show();
                                    $('#bell-icon').removeClass('bi-bell').addClass('bi-bell-fill');
                                }
                            });

                            connectNotificationSocket(); // connect to the relevant websocket
                        </script>
                        <!-- To store notifications -->
                        <div class="toast-container position-fixed bottom-0 end-0 p-3" id="inbox">

                        </div>
