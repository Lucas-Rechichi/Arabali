{% extends 'main/template.html' %}
{% load crispy_forms_tags %}
{% block title %}Add Post{% endblock %}
{% block topsidebar %}
<li class="custom-icon"><div class="fs-4"><i class="bi bi-person" style="color: #787878;"></i></div> <a href="/profile/{{username}}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Profile</p></a></li>
{% endblock %}
{% block middlesidebar %}
<li class="custom-icon"><div class="fs-4"><i class="bi bi-gear-wide-connected" style="color: #787878;"></i></div> <a href="/settings/{{username}}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"><p class="lead">Settings</p></a></li>
{% endblock %}
{% block searchBar %}
{{search_bar| crispy}}
{% endblock %}
{% block body %}
<div class="card contents">
    <div class="container">
        <form method="post", enctype="multipart/form-data">
            {% csrf_token %}
            {{ input_fields | crispy }}
            <div class="row">
                <label for=""><p class="lead" style="color: #787878;">Tags cannot include the vertical line symbol ( | ).</p></label>
            </div>
            <br>
            <div class="row">
                <button type="submit", class="btn btn-success">Post</button>
            </div>
        </form>
    </div>
</div>
<!-- Websockets for recieving notifications -->
<script type="text/javascript">
    const notificationSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/brordcast-message/'
    );
    notificationSocket.onopen = function() {
        
    };

    notificationSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log(data)
        $('#inbox').append(data.html_notification);
        var inbox = document.getElementById('inbox');
        inbox.insertAdjacentHTML('afterbegin', data.html_notification);

        var notificationElement = document.getElementById('notification-' + data.notification_id);
        var notification = new bootstrap.Toast(notificationElement);

        // Show the toast
        notification.show();
    };

    notificationSocket.onerror = function(e) {
        console.error('WebSocket encountered an error:', e);
    };

    notificationSocket.onclose = function(e) {
        console.error('WebSocket closed unexpectedly:', e);
    };
</script>
<!-- To store notifications -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" id="inbox">

</div>
{% endblock %}